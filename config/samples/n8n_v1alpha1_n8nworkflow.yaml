apiVersion: n8n.slys.dev/v1alpha1
kind: N8nWorkflow
metadata:
  labels:
    app.kubernetes.io/name: n8n-resource-operator
    app.kubernetes.io/managed-by: kustomize
  name: simple-webhook
  namespace: n8n
spec:
  # n8n instance configuration (choose one approach)
  n8nRef:
    # Option 1: Direct URL (recommended for external n8n instances)
    # url: "https://n8n.example.com"

    # Option 2: Kubernetes service discovery
    name: n8n-service
    namespace: n8n
    port: 5678

    # API key secret reference (required)
    secretRef:
      name: n8n-api-key
      key: api-key

  # Sync policy controls how the operator handles changes
  # - Always: Continuously sync, overwriting UI changes (default)
  # - CreateOnly: Create once, then allow UI editing
  # - Manual: Pause all sync operations
  syncPolicy: Always

  # Whether the workflow should be active in n8n
  active: true

  # The workflow definition
  workflow:
    name: "Simple Webhook"
    nodes:
      - id: "webhook-1"
        name: "Webhook"
        type: "n8n-nodes-base.webhook"
        typeVersion: 2
        parameters:
          httpMethod: "POST"
          path: "simple"
          responseMode: "lastNode"
        position: [0, 0]
      - id: "set-1"
        name: "Set Response"
        type: "n8n-nodes-base.set"
        typeVersion: 3.4
        parameters:
          mode: "manual"
          assignments:
            assignments:
              - name: "message"
                value: "Hello from n8n!"
                type: "string"
              - name: "timestamp"
                value: "={{ $now.toISO() }}"
                type: "string"
        position: [200, 0]
    connections:
      Webhook:
        main:
          - - node: "Set Response"
              type: "main"
              index: 0
    settings:
      executionOrder: "v1"
